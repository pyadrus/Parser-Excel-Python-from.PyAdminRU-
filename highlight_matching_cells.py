import openpyxl
from openpyxl.styles import PatternFill


def highlight_matching_data(file1_path, file2_path):
    """
    Сравнивает данные из двух Excel-файлов и выделяет совпадающие значения красным цветом во втором файле.

    Параметры:
    - file1_path (str): Путь к первому файлу Excel.
    - file2_path (str): Путь ко второму файлу Excel.

    Логика работы:
    1. Открывает первый файл и читает значения из столбца E (начиная с 4 строки).
    2. Открывает второй файл и читает значения из столбца F (начиная с 6 строки).
    3. Если значение из первого файла совпадает со значением из второго файла,
       соответствующая ячейка в столбце H второго файла выделяется красным цветом.
    4. Сохраняет изменения во втором файле.

    Примечание: Убедитесь, что указанные столбцы и строки содержат необходимые данные.
    """

    try:
        # Открываем первый файл
        wb1 = openpyxl.load_workbook(file1_path)
        sheet1 = wb1['1']  # Выбираем лист '1' из первого файла

        # Открываем второй файл
        wb2 = openpyxl.load_workbook(file2_path)
        sheet2 = wb2['1']  # Выбираем лист '1' из второго файла

        # Проходим по всем строкам первого файла, начиная с 4 строки, столбец E (5)
        for i in range(4, sheet1.max_row + 1):
            cell_value = str(sheet1.cell(row=i, column=5).value)  # Значение из столбца E

            # Проходим по всем строкам второго файла, начиная с 6 строки, столбец F (6)
            for row_index in range(6, sheet2.max_row + 1):
                cell_value_2 = str(sheet2.cell(row=row_index, column=6).value)  # Значение из столбца F

                # Проверяем, совпадают ли значения
                if cell_value == cell_value_2:
                    # Если совпадение найдено, выделяем ячейку в столбце H красным цветом
                    sheet2.cell(row=row_index, column=8).fill = PatternFill(
                        start_color="FF0000", end_color="FF0000", fill_type="solid"
                    )

        # Сохраняем изменения во втором файле
        wb2.save(file2_path)
        print("Совпадения успешно выделены и файл сохранён.")

    except FileNotFoundError as e:
        print(f"Ошибка: Файл не найден. Проверьте пути к файлам. ({e})")
    except Exception as e:
        print(f"Произошла ошибка: {e}")


# Пример использования функции
if __name__ == "__main__":
    # Укажите пути к вашим файлам
    file1_path = 'Копия Список-отсутствующих-01-11-2023-30-11-2023(522458277).xlsx'
    file2_path = 'Копия Списочный-состав--20231201-(522458277).xlsx'

    # Вызов функции для обработки файлов
    highlight_matching_data(file1_path, file2_path)
